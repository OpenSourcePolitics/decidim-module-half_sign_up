<div class="card budget-summary" data-progress-reference data-safe-url="<%= budget_url(budget) %>">

  <% methods = current_organization.auth_setting&.available_methods %>

  <div class="card__content">
    <% if current_order_checked_out? %>
      <h2 class="heading3">
        <%= t(".pre_vote.casted_title") %>
      </h2>
      <p>
        <%= raw t(".pre_vote.casted_description", cancel_link: link_to(t(".cancel_order"), budget_order_path(return_to: "budget"), method: :delete, class: "cancel-order", data: { confirm: t(".are_you_sure") })) %>
      </p>
      <div class="align-right">
        <%= link_to(t(".pre_vote.result_voted"), decidim_budgets.budget_order_path(budget), class: "button hollow button--sc pull-right", remote: true) %>
      </div>
    <% else %>
      <h2 class="heading3">
        <%= t(".pre_vote.title") %>
      </h2>
      <p>
        <%= description_text %>

        <% if methods.empty? || current_user %>
          <%= button_to vote_text, budget_voting_index_path, class: "button hollow button--sc pull-right", method: :get, disabled: !voting_open? %>
        <% elsif methods.length == 1 %>
          <% if methods.include?("email") %>
            <%= link_to vote_text, decidim_half_signup.users_quick_auth_email_path(redirect_url: budget_voting_index_path), class: "button hollow button--sc pull-right" %>
          <% elsif methods.include?("sms") %>
            <%= link_to vote_text, decidim_half_signup.users_quick_auth_sms_path(redirect_url: budget_voting_index_path), class: "button hollow button--sc pull-right" %>
          <% end %>
        <% else %>
          <%= link_to vote_text, "#", class: "button hollow button--sc pull-right", data: { toggle: "halfSignupLoginModal" } %>
        <% end %>
      </p>
    <% end %>
  </div>
</div>
<%= render partial: "decidim/budgets/voting/voted_summary_modal" if current_order_checked_out? %>
<%= render partial: "decidim/shared/half_signup_login_modal", locals: { redirect_path: budget_voting_index_path } unless current_user %>


